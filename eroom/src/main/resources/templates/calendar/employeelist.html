<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{/include/layout}">

<head>
<title>개인 캘린더</title>
</head>
<body>

	<main class="main" id="top" layout:fragment="content">

		<div class="row g-0 mb-4 align-items-center">
			<div class="col-5 col-md-6">
				<h4 class="mb-0 text-body-emphasis fw-bold fs-md-6">
					<span class="calendar-day d-block d-md-inline mb-1"></span> <span
						class="px-3 fw-thin text-body-quaternary d-none d-md-inline">|</span>
					<span class="calendar-date"></span>
				</h4>
			</div>
			<div class="col-7 col-md-6 d-flex justify-content-end">
				<button class="btn btn-primary btn-sm" type="button"
					data-bs-toggle="modal" data-bs-target="#addEventModal">
					<span class="fas fa-plus pe-2 fs-10"></span>일정 등록
				</button>
			</div>
		</div>




	<!-- 	<div class="mx-n4 px-4 mx-lg-n6 px-lg-6 border-y border-translucent">
			<div class="row py-3 gy-3 gx-0">
				<div class="col-6 col-md-4 order-1 d-flex align-items-center">
					<button class="btn btn-sm btn-phoenix-primary px-4"
						data-event="today">Today</button>
				</div>
				<div
					class="col-12 col-md-4 order-md-1 d-flex align-items-center justify-content-center">
					<button
						class="btn icon-item icon-item-sm shadow-none text-body-emphasis p-0"
						type="button" data-event="prev" title="Previous">
						<span class="fas fa-chevron-left"></span>
					</button>
					<h3 class="px-3 text-body-emphasis fw-semibold calendar-title mb-0"></h3>
					<button
						class="btn icon-item icon-item-sm shadow-none text-body-emphasis p-0"
						type="button" data-event="next" title="Next">
						<span class="fas fa-chevron-right"></span>
					</button>
				</div>
				<div
					class="col-6 col-md-4 ms-auto order-1 d-flex justify-content-end">
					<div class="btn-group btn-group-sm" role="group">
						<button class="btn btn-phoenix-secondary active-view"
							data-fc-view="dayGridMonth">월별</button>
						<button class="btn btn-phoenix-secondary"
							data-fc-view="timeGridWeek">주별</button>
					</div>
				</div>
			</div>
		</div> -->

		<!-- 일정 등록 모달 -->
		<div class="modal fade" id="addEventModal" tabindex="-1">
			<div class="modal-dialog">
				<div class="modal-content border border-translucent">
					<form id="addEventForm" autocomplete="off" name="addEventForm">
						<div class="modal-header px-card border-0">
							<div
								class="w-100 d-flex justify-content-between align-items-start">
								<h5 class="mb-0 lh-sm text-body-highlight">일정 등록</h5>
								<button class="btn p-1 fs-10 text-body" type="button"
									data-bs-dismiss="modal" aria-label="Close">닫기</button>
							</div>
						</div>



						<div class="modal-body p-card py-0">
							<input type="hidden" name="employee_no"
								th:value="${#authentication.principal.employee.employeeNo}" />
							<!-- <input type="hidden" name="separator" value="E001"> -->

							<div class="form-floating mb-3">
								<input class="form-control" id="eventTitle" type="text"
									name="calendar_title" placeholder="일정 제목" /> <label
									for="eventTitle">일정 제목</label>
							</div>

							<div class="form-floating mb-3">
								<input class="form-control" id="eventLocation" type="text"
									name="calendar_location" placeholder="일정 장소" /> <label
									for="eventLocation">일정 장소</label>
							</div>

							<div class="form-floating mb-3">
								<input class="form-control" id="startDatetime"
									type="datetime-local" name="calendar_start" placeholder="시작 시간" />
								<label for="startDatetime">시작 시간</label>
							</div>

							<div class="form-floating mb-3">
								<input class="form-control" id="endDatetime"
									type="datetime-local" name="calendar_end" placeholder="종료 시간" />
								<label for="endDatetime">종료 시간</label>
							</div>

							<div class="form-floating mb-3">
								<input class="form-control" id="eventDescription" type="text"
									name="calendar_description" placeholder="일정 설명" /> <label
									for="eventDescription">일정 설명</label>
							</div>
						</div>

						<div
							class="modal-footer d-flex justify-content-between align-items-center border-0">
							<span></span>
							<button class="btn btn-primary px-4" type="submit">일정 등록</button>
						</div>
					</form>
				</div>
			</div>
		</div>


		<!-- 캘린더 위치 -->
		<div class="calendar-outline mt-6 mb-9" id="appCalendar"></div>



		<!-- 	<script>
				  document.addEventListener('DOMContentLoaded', function () {
				    const calendarEl = document.getElementById('appCalendar');
				    const employeeNo = document.addEventForm.employee_no.value;
				
				    const calendar = new FullCalendar.Calendar(calendarEl, {
				      initialView: 'dayGridMonth',
				      locale: 'ko',
				      headerToolbar: {
				        left: 'prev,next today',
				        center: 'title',
				        right: 'dayGridMonth,timeGridWeek'
				      },
				      events: function(fetchInfo, successCallback, failureCallback) {
				        fetch('/employeecalendar/list/' + employeeNo)
				          .then(response => response.json())
				          .then(events => {
				            successCallback(events);
				          })
				          .catch(error => {
				            console.error("이벤트 불러오기 실패", error);
				            failureCallback(error);
				          });
				      }
				    });
				
				    calendar.render();
  				});
		</script> -->
		<script>
				document.addEventListener('DOMContentLoaded', function () {
		  		const calendarEl = document.getElementById('appCalendar');
		  		const employeeNo = document.addEventForm.employee_no.value;
		
		  	const calendar = new FullCalendar.Calendar(calendarEl, {
		    initialView: 'dayGridMonth',
		    locale: 'ko',
		    headerToolbar: {
		      left: 'prev,next today',
		      center: 'title',
		      right: 'dayGridMonth,timeGridWeek'
		    },
		  
		    dayCellContent: function(info) {
		        return info.date.getDate(); // '1일' -> '1'로
		      },
		    eventClick: function(info) {
		      alert("제목: " + info.event.title + "\n설명: " + info.event.extendedProps.description);
		    },
		    eventDidMount: function(info) {
		      // 툴팁 처리 (tippy.js를 쓴다면 더 예쁨)
		      info.el.setAttribute("title", info.event.extendedProps.description || info.event.title);
		    },
		    events: function(fetchInfo, successCallback, failureCallback) {
		      fetch('/employeecalendar/list/' + employeeNo)
		        .then(response => response.json())
		        .then(events => {
		          successCallback(events);
		        })
		        .catch(error => {
		          console.error("이벤트 불러오기 실패", error);
		          failureCallback(error);
		        });
		    }
		  });
		
		  calendar.render();
	});
		</script>


		<!-- 일정 등록 처리 스크립트 -->
	<script>
    const form = document.addEventForm;
    form.addEventListener("submit", function (e) {
      e.preventDefault();

      if (!form.calendar_location.value) {
        alert("장소를 입력해주세요");
        return;
      }

      const payload = new FormData(form);
      fetch("/employeecalendar/add", {
        method: "post",
        headers: {
          'header': document.querySelector('meta[name="_csrf_header"]').content,
          'X-CSRF-Token': document.querySelector('meta[name="_csrf"]').content
        },
        body: payload
      })
        .then(response => response.json())
        .then(data => {
          alert(data.res_msg);
          if (data.res_code == 200) {
            location.reload();
          }
        });
    });
  </script>





	</main>
</body>